<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>英雄裝備分析</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .hero-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .hero-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4A90E2;
        }
        .hero-info {
            flex-grow: 1;
        }
        .hero-name {
            font-size: 24px;
            margin: 0 0 10px 0;
            color: #333;
        }
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            color: #666;
        }
        .stat-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
        }
        .stat-label {
            font-weight: bold;
            color: #555;
        }
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .item-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .item-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .item-image {
            width: 40px;
            height: 40px;
            border-radius: 4px;
        }
        .item-name {
            margin: 0;
            font-size: 16px;
            color: #333;
        }
        .item-stats {
            display: grid;
            gap: 5px;
        }
        .positive-delta {
            color: #28a745;
        }
        .negative-delta {
            color: #dc3545;
        }
        .back-button {
            display: inline-block;
            padding: 8px 16px;
            background: #4A90E2;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .back-button:hover {
            background: #357ABD;
        }
        #container {
            background: white;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <a href="hero_list.html" class="back-button">← 返回英雄列表</a>
    
    <div id="container">
        <div class="hero-header">
            <img id="heroImage" class="hero-image" alt="英雄圖片">
            <div class="hero-info">
                <h1 id="heroName" class="hero-name">載入中...</h1>
                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-label">平均名次: </span>
                        <span id="avgPlacement">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Delta: </span>
                        <span id="delta">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">使用次數: </span>
                        <span id="totalGames">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">勝率: </span>
                        <span id="winRate">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">前四率: </span>
                        <span id="top4Rate">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="itemsContainer" class="items-grid">
            <!-- 裝備卡片將在這裡動態生成 -->
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                console.log('開始加載英雄數據...');
                const urlParams = new URLSearchParams(window.location.search);
                const heroId = urlParams.get('hero');
                
                if (!heroId) {
                    throw new Error('未指定英雄ID');
                }
                
                console.log('英雄ID:', heroId);
                const heroName = heroId.replace('TFT13_', '');
                document.getElementById('heroName').textContent = heroName;
                document.title = `${heroName} - 裝備分析`;
                
                const response = await fetch(`hero_data/${heroId}.json`);
                console.log('嘗試加載:', `hero_data/${heroId}.json`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('英雄數據加載成功:', data);
                console.log('數據類型:', typeof data);
                console.log('數據結構:', JSON.stringify(data, null, 2));
                
                // 檢查數據結構
                if (!data || typeof data !== 'object') {
                    throw new Error('無效的數據格式');
                }

                // 檢查hero屬性
                if (!data.hero || typeof data.hero !== 'object') {
                    console.error('無效的hero數據:', data.hero);
                    throw new Error('無效的英雄數據格式');
                }
                
                // 更新英雄圖片
                const heroImgSrc = `./tft13_character_images/tft13_${heroName.toLowerCase()}_square.tft_set13.jpg`;
                const heroImg = document.getElementById('heroImage');
                heroImg.src = heroImgSrc;
                heroImg.onerror = function() {
                    this.onerror = null;
                    const fallbackSvg = `data:image/svg+xml,${encodeURIComponent(
                        `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
                            <rect width="100" height="100" fill="#4A90E2"/>
                            <text x="50" y="50" font-size="20" fill="white" text-anchor="middle" dominant-baseline="middle">
                                ${heroName.slice(0, 2).toUpperCase()}
                            </text>
                        </svg>`
                    )}`;
                    this.src = fallbackSvg;
                };
                
                // 更新英雄統計數據
                const hero = data.hero;
                console.log('英雄數據:', hero);

                // 安全地獲取數值並轉換
                const getNumberValue = (obj, key) => {
                    const value = obj[key];
                    if (value === undefined || value === null) {
                        console.warn(`${key} 值不存在`);
                        return 0;
                    }
                    const num = Number(value);
                    if (isNaN(num)) {
                        console.warn(`${key} 值無法轉換為數字:`, value);
                        return 0;
                    }
                    return num;
                };

                // 更新統計數據
                document.getElementById('avgPlacement').textContent = getNumberValue(hero, 'avgPlacement').toFixed(2);
                document.getElementById('delta').textContent = getNumberValue(hero, 'delta').toFixed(2);
                document.getElementById('totalGames').textContent = getNumberValue(hero, 'totalGames');
                document.getElementById('winRate').textContent = `${getNumberValue(hero, 'winRate')}%`;
                document.getElementById('top4Rate').textContent = `${getNumberValue(hero, 'top4Rate')}%`;
                
                // 設置Delta的顏色
                const deltaElement = document.getElementById('delta');
                const deltaStat = getNumberValue(hero, 'delta');
                if (deltaStat < 0) {
                    deltaElement.classList.add('negative-delta');
                    deltaElement.classList.remove('positive-delta');
                } else {
                    deltaElement.classList.add('positive-delta');
                    deltaElement.classList.remove('negative-delta');
                }
                
                // 渲染裝備列表
                const itemsContainer = document.getElementById('itemsContainer');
                itemsContainer.innerHTML = '';
                
                if (!Array.isArray(data.items)) {
                    console.error('無效的items數據:', data.items);
                    throw new Error('裝備數據格式錯誤');
                }
                
                console.log('裝備數量:', data.items.length);
                
                data.items.forEach((item, index) => {
                    if (!item || typeof item !== 'object') {
                        console.warn(`跳過無效的裝備數據 [${index}]:`, item);
                        return;
                    }
                    
                    console.log(`處理裝備 [${index}]:`, item);
                    
                    const itemCard = document.createElement('div');
                    itemCard.className = 'item-card';
                    
                    const itemName = (item.item || '').replace('TFT_Item_', '').replace('TFT13_Item_', '');
                    const itemImgSrc = `./tft13_item_images/tft_item_${itemName.toLowerCase()}.tft_set13.png`;
                    
                    itemCard.innerHTML = `
                        <div class="item-header">
                            <img src="${itemImgSrc}" 
                                 alt="${itemName}" 
                                 class="item-image"
                                 onerror="this.onerror=null; this.src='data:image/svg+xml,${encodeURIComponent(
                                     `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40">
                                         <rect width="40" height="40" fill="#4A90E2"/>
                                         <text x="20" y="20" font-size="12" fill="white" text-anchor="middle" dominant-baseline="middle">
                                             ${itemName.slice(0, 2).toUpperCase()}
                                         </text>
                                     </svg>`
                                 )}';">
                            <h3 class="item-name">${itemName}</h3>
                        </div>
                        <div class="item-stats">
                            <div>
                                <span class="stat-label">平均名次:</span>
                                <span>${getNumberValue(item, 'avgWithItem').toFixed(2)}</span>
                            </div>
                            <div>
                                <span class="stat-label">Delta:</span>
                                <span class="${getNumberValue(item, 'delta') < 0 ? 'negative-delta' : 'positive-delta'}">
                                    ${getNumberValue(item, 'delta').toFixed(2)}
                                </span>
                            </div>
                            <div>
                                <span class="stat-label">使用次數:</span>
                                <span>${getNumberValue(item, 'games')}</span>
                            </div>
                            <div>
                                <span class="stat-label">使用率:</span>
                                <span>${getNumberValue(item, 'usageRate').toFixed(1)}%</span>
                            </div>
                        </div>
                    `;
                    
                    itemsContainer.appendChild(itemCard);
                });
                
            } catch (error) {
                console.error('加載數據時出錯:', error);
                const container = document.getElementById('container');
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #dc3545;">
                        <h2>無法載入英雄數據</h2>
                        <p>錯誤信息: ${error.message}</p>
                        <p>請檢查控制台以獲取更多信息</p>
                    </div>
                `;
            }
        }

        loadData();
    </script>
</body>
</html> 