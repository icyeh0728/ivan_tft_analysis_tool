<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>英雄裝備分析</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .hero-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .hero-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4A90E2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .hero-info {
            flex-grow: 1;
        }
        .hero-name {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            color: #333;
        }
        .hero-stats {
            color: #666;
            margin-top: 5px;
        }
        .table-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            cursor: pointer;
        }
        th:hover {
            background-color: #e9ecef;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .item-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .item-image {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }
        .sort-icon::after {
            content: '⇅';
            margin-left: 5px;
            color: #999;
        }
        .sort-asc::after {
            content: '↑';
            color: #333;
        }
        .sort-desc::after {
            content: '↓';
            color: #333;
        }
        .positive-delta {
            color: #dc3545;
        }
        .negative-delta {
            color: #28a745;
        }
        .back-button {
            display: inline-block;
            padding: 8px 16px;
            background: #4A90E2;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-bottom: 20px;
            transition: background 0.2s;
        }
        .back-button:hover {
            background: #357ABD;
        }
    </style>
</head>
<body>
    <a href="hero_list.html" class="back-button">← 返回英雄列表</a>
    
    <div class="hero-header">
        <img id="heroImage" class="hero-image" alt="Hero">
        <div class="hero-info">
            <h1 class="hero-name" id="heroName">載入中...</h1>
            <div class="hero-stats" id="heroStats">載入中...</div>
        </div>
    </div>
    
    <div class="table-container">
        <table id="itemTable">
            <thead>
                <tr>
                    <th data-sort="item" class="sort-icon">裝備</th>
                    <th data-sort="delta" class="sort-icon">Delta值</th>
                    <th data-sort="avgWithItem" class="sort-icon">平均名次</th>
                    <th data-sort="usage" class="sort-icon">使用次數</th>
                    <th data-sort="usageRate" class="sort-icon">使用率</th>
                </tr>
            </thead>
            <tbody>
                <!-- 數據將通過JavaScript填充 -->
            </tbody>
        </table>
    </div>

    <script>
        function createItemImage(itemName) {
            return new Promise((resolve) => {
                const img = document.createElement('img');
                img.className = 'item-image';
                const processedName = itemName.replace('TFT_Item_', '').toLowerCase();
                const imagePath = `./tft13_item_images/tft_item_${processedName}.tft_set13.png`;
                img.src = imagePath;
                img.onerror = () => {
                    img.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"><rect width="30" height="30" fill="%23E67E22"/><text x="15" y="20" font-size="12" fill="white" text-anchor="middle">' + processedName.slice(0, 2).toUpperCase() + '</text></svg>';
                };
                resolve(img);
            });
        }

        let currentSort = {
            column: 'usage',
            direction: 'desc'
        };

        function sortTable(column) {
            const headers = document.querySelectorAll('th');
            headers.forEach(header => {
                if (header.dataset.sort === column) {
                    if (currentSort.column === column) {
                        header.classList.toggle('sort-asc');
                        header.classList.toggle('sort-desc');
                    } else {
                        header.classList.add('sort-asc');
                        header.classList.remove('sort-desc');
                    }
                } else {
                    header.classList.remove('sort-asc', 'sort-desc');
                }
            });

            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            renderTable();
        }

        let itemData = [];

        function renderTable() {
            const tbody = document.querySelector('tbody');
            const sortedData = [...itemData].sort((a, b) => {
                const aValue = a[currentSort.column];
                const bValue = b[currentSort.column];
                const modifier = currentSort.direction === 'asc' ? 1 : -1;
                
                if (typeof aValue === 'string') {
                    return aValue.localeCompare(bValue) * modifier;
                }
                return (aValue - bValue) * modifier;
            });

            tbody.innerHTML = '';
            sortedData.forEach(async item => {
                const row = tbody.insertRow();
                const itemCell = row.insertCell();
                itemCell.className = 'item-cell';
                const img = await createItemImage(item.item);
                itemCell.appendChild(img);
                itemCell.appendChild(document.createTextNode(item.item.replace('TFT_Item_', '')));

                const deltaCell = row.insertCell();
                deltaCell.textContent = item.delta.toFixed(3);
                deltaCell.className = item.delta < 0 ? 'negative-delta' : 'positive-delta';

                const avgWithItemCell = row.insertCell();
                avgWithItemCell.textContent = item.avgWithItem.toFixed(3);

                const usageCell = row.insertCell();
                usageCell.textContent = item.usage;

                const usageRateCell = row.insertCell();
                usageRateCell.textContent = item.usageRate + '%';
            });
        }

        async function loadData() {
            try {
                // 從URL獲取英雄ID
                const urlParams = new URLSearchParams(window.location.search);
                const heroId = urlParams.get('hero');
                
                if (!heroId) {
                    throw new Error('未指定英雄');
                }

                // 載入英雄數據
                const response = await fetch(`hero_data/${heroId}.json`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('數據加載成功:', data);
                
                // 更新頁面標題和英雄圖片
                const heroName = heroId.replace('TFT13_', '');
                document.title = `${heroName} - 裝備分析`;
                
                // 設置英雄圖片
                const heroImage = document.getElementById('heroImage');
                heroImage.src = `tft13_character_images/tft13_${heroName.toLowerCase()}_square.tft_set13.jpg`;
                heroImage.alt = heroName;
                heroImage.onerror = () => {
                    heroImage.src = `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80"><rect width="80" height="80" fill="%234A90E2"/><text x="40" y="50" font-size="24" fill="white" text-anchor="middle">${heroName.slice(0, 2).toUpperCase()}</text></svg>`;
                };

                // 更新英雄名稱
                document.getElementById('heroName').textContent = heroName;

                // 更新英雄統計數據
                const statsHtml = `
                    平均名次: ${data.avgPlacement.toFixed(2)} | 
                    Delta: <span class="${data.delta < 0 ? 'negative-delta' : 'positive-delta'}">${data.delta.toFixed(2)}</span> | 
                    總場次: ${data.totalGames} | 
                    勝率: ${data.winRate}% | 
                    前四率: ${data.top4Rate}%
                `;
                document.getElementById('heroStats').innerHTML = statsHtml;

                // 處理裝備數據
                itemData = data.items.map(item => ({
                    item: item.name,
                    delta: item.delta,
                    avgWithItem: item.avgPlacementWithItem,
                    usage: item.gamesWithItem,
                    usageRate: ((item.gamesWithItem / data.totalGames) * 100).toFixed(1)
                }));

                // 渲染表格
                renderTable();

                // 添加表格排序事件監聽器
                document.querySelectorAll('th').forEach(header => {
                    header.addEventListener('click', () => {
                        sortTable(header.dataset.sort);
                    });
                });

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('heroStats').innerHTML = '無法載入英雄數據';
                document.getElementById('itemTable').innerHTML = '無法載入裝備數據';
            }
        }

        // 載入數據
        loadData();
    </script>
</body>
</html> 